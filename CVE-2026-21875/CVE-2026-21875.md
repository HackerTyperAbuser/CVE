**Exploit Title**: ClipBucket v5 Blind SQL Injection
**Category**: webapps
**Vulnerability**: SQL Injection 
**CVSS**: 8.1 High
**Programming Language**: PHP
**References:**
- https://nvd.nist.gov/vuln/detail/CVE-2026-21875
- https://github.com/MacWarrior/clipbucket-v5/commit/fedcb0ef10d1a4e1ecd0627b3b624e1805db948e
## Static Analysis
A helper function `user_exists` under `upload/includes/classes/user.class.php` takes direct user input into its query.
```php
function user_exists($id, $global = false): bool
{
	if (is_numeric($id)) {
		$field = 'userid';
	} else {
		$field = 'username';
	}
    $result = Clipbucket_db::getInstance()->count(tbl($this->dbtbl['users']), 'userid', $field.'=\'' . $id . '\'', '',60);

    if ($result > 0) {
       return true;
    }
    return false;
}
```
Here the vulnerable code, is trying to count the number of `userId` that exists in the user database. Since `userId` is unique this code is essentially trying to find if the user exists. 
```php
$result = Clipbucket_db::getInstance()->count(
    tbl($this->dbtbl['users']),                 // 1. table name (users)
    'userid',                                   // 2. column to count
    $field.'=\'' . $id . '\'',                  // 3. WHERE clause if control $id -> SQL Injection
    '',                                          // 4. optional GROUP BY (empty here)
    60                                           // 5. cache time or TTL (seconds)
);
```
Since this is a helper function it is used in many features (e.g. Remove all user subscribers).
![](Pasted%20image%2020260108141405.png)
## Dynamic Analysis
## Patch Analysis
The one line patch was added surrounding `$id` with the function `mysql_clean($id)`
![](Pasted%20image%2020260108135730.png)
This function get the instance of the `Clipbucket_db` object and calls its `clean_var($var)` method. 
![](Pasted%20image%2020260108135628.png)
`clean_var($var)` ultimately calls the PHP built in function `real_escape_string($var)`
![](Pasted%20image%2020260108135503.png)
This function ultimately sanitizes special characters in a string for use in a SQL query.
- https://www.php.net/manual/en/mysqli.real-escape-string.php
![](Pasted%20image%2020260108140101.png)